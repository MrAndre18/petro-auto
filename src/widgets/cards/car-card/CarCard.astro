---
import Icon, { type IconKey } from '@shared/ui/icon/Icon.astro'
import Picture from '@shared/ui/picture/Picture.astro'
import type { SwiperOptions } from 'swiper/types'

interface Props {
  class?: string
  images: string[]
  title: string
  price: string
  country: 'Korea' | 'Japan' | 'USA' | 'China'
  specifications: {
    name: string
    value: string
  }[]
  economy: string
  duration: string
}

const {
  class: className,
  images,
  title,
  price,
  country,
  specifications,
  economy,
  duration,
  ...props
} = Astro.props as Props

// Генерируем уникальный ID для свайпера
const swiperId = `car-card-${Math.random().toString(36).substr(2, 9)}`

const countryIcon = {
  Korea: 'korea',
  Japan: 'japan',
  USA: 'usa',
  China: 'china'
}

const countryText = {
  Korea: 'Из Кореи',
  Japan: 'Из Японии',
  USA: 'Из США',
  China: 'Из Китая'
}

// Настройки свайпера с эффектом fade
const sliderOptions = {
  effect: 'fade',
  fadeEffect: {
    crossFade: true
  },
  allowTouchMove: true,
  nested: true
} as SwiperOptions

export { CarCard }
---

<article
  class:list={['car-card', className]}
  {...props}
>
  <div
    class="swiper car-card__swiper"
    data-swiper={swiperId}
    data-swiper-params={JSON.stringify(sliderOptions)}
  >
    <div class="swiper-wrapper">
      {
        images.map((image, index) => (
          <div class="swiper-slide">
            <Picture
              src={image}
              alt={`${title} - фото ${index + 1}`}
              class="car-card__image"
            />
          </div>
        ))
      }
    </div>
  </div>

  <div class="car-card__content">
    <div class="flex flex-col gap-6 devices:gap-4">
      <div class="flex flex-col gap-2">
        <h3 class="line-clamp-1 font-title text-title-32 devices:text-title-24">{title}</h3>
        <div class="flex items-center gap-3">
          <Icon
            name={countryIcon[country] as IconKey}
            initial
            class="size-5 devices:size-4"
          />
          <span class="text-16 text-gray-dark devices:text-14">{countryText[country]}</span>
        </div>
        <span class="font-title text-title-24 text-primary/60 devices:text-title-16">{price}</span>
      </div>

      <ul class="flex flex-col gap-3">
        {
          specifications.map(({ name, value }) => (
            <li class="flex items-end justify-between gap-2 border-b border-gray-light pb-3 last:border-b-0 last:pb-0">
              <span class="text-16 text-gray-dark devices:text-14">{name}</span>
              <span class="text-18 devices:text-16">{value}</span>
            </li>
          ))
        }
      </ul>
    </div>

    <div class="grid grid-cols-2">
      <div class="flex flex-col items-center border-r border-accent text-center">
        <span class="font-title text-title-24 devices:text-title-16">{economy}</span>
        <span class="text-16 text-gray-dark devices:text-14">Экономия</span>
      </div>

      <div class="flex flex-col items-center text-center">
        <span class="font-title text-title-24 devices:text-title-16">{duration}</span>
        <span class="text-16 text-gray-dark devices:text-14">Под ключ</span>
      </div>
    </div>
  </div>

  <style>
    @import './car-card.scss';
  </style>
</article>
